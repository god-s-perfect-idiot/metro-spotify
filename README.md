# Metro Spotify - Android App

A Metro UI-designed Spotify music player for Android, built with Svelte and Capacitor.

## Features

- ðŸŽµ Spotify integration with OAuth authentication
- ðŸ“± Native Android app experience
- ðŸŽ¨ Metro UI design language
- ðŸŽ§ Music playback control
- ðŸ“š Liked songs library
- ðŸ” Alphabetical navigation
- ðŸ“Š Custom status bar (fullscreen mode with custom UI)

## Prerequisites

Before you begin, ensure you have the following installed:

- **Node.js** (v18 or higher)
- **npm** or **yarn**
- **Android Studio** (for Android development)
- **Java Development Kit (JDK)** (version 17 or higher)
- **Android SDK** (API level 33 or higher)

## Setup

### 1. Install Dependencies

```bash
npm install
```

### 2. Spotify Developer Setup

1. Go to [Spotify Developer Dashboard](https://developer.spotify.com/dashboard)
2. Create a new app or use an existing one
3. Copy your **Client ID** and **Client Secret**
4. Add the redirect URI: `metrospotify://callback`
5. Store these credentials (you'll need them in the app)

### 3. Configure Android Deep Links

The app uses the custom URL scheme `metrospotify://callback` for OAuth callbacks. This is already configured in the Capacitor config.

### 4. Build the Web App

```bash
npm run build
```

### 5. Sync with Android

```bash
npm run android:sync
```

This will create the Android project in the `android/` directory if it doesn't exist.

### 6. Open in Android Studio

```bash
npm run android:open
```

Or manually open the `android/` folder in Android Studio.

## Development

### Run Web Development Server

```bash
npm run dev
```

This starts a development server at `http://localhost:5173`.

### Build and Sync Android

```bash
npm run android:build
```

This builds the web app and syncs it with the Android project.

### Run on Android Device/Emulator

1. Open the project in Android Studio
2. Connect an Android device or start an emulator
3. Click the "Run" button in Android Studio

## Project Structure

```
metro-spotify/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # Reusable Svelte components
â”‚   â”œâ”€â”€ pages/               # Page components (SpotifyPage, etc.)
â”‚   â”œâ”€â”€ store/               # State management (accounts, music, toast)
â”‚   â”œâ”€â”€ lib/                 # Utility libraries (router, config)
â”‚   â”œâ”€â”€ utils/               # Utility functions (theme)
â”‚   â”œâ”€â”€ App.svelte          # Main app component
â”‚   â””â”€â”€ main.js             # Entry point
â”œâ”€â”€ legacy-ubq/             # Original SvelteKit codebase (for reference)
â”œâ”€â”€ android/                # Android project (generated by Capacitor)
â”œâ”€â”€ capacitor.config.ts     # Capacitor configuration
â”œâ”€â”€ vite.config.js          # Vite build configuration
â””â”€â”€ package.json            # Dependencies and scripts
```

## Configuration

### Capacitor Config

The main configuration is in `capacitor.config.ts`:

- **appId**: `com.metrospotify.app`
- **appName**: `Metro Spotify`
- **Deep Link**: `metrospotify://callback`

### Spotify OAuth

The app uses OAuth 2.0 Authorization Code flow. The redirect URI must match what's configured in your Spotify app settings:

- **Development/Android**: `metrospotify://callback`

## Building for Production

### 1. Build the Web App

```bash
npm run build
```

### 2. Sync with Android

```bash
npm run android:sync
```

### 3. Build APK/AAB in Android Studio

1. Open the project in Android Studio
2. Go to **Build > Generate Signed Bundle / APK**
3. Follow the wizard to create a signed release build

## Important Notes

### OAuth Token Exchange

**Security Warning**: The current implementation attempts client-side token exchange, which is not secure for production. For production apps, you should:

1. Create a backend server endpoint to handle token exchange
2. Store the Client Secret on the server only
3. Use PKCE (Proof Key for Code Exchange) flow for better security

### Spotify Web Playback SDK

The app uses the Spotify Web Playback SDK for music playback. This requires:
- A Spotify Premium account
- An active device/player

### Android Permissions

The app requires the following permissions (automatically added by Capacitor):
- Internet access
- Network state access

### Fullscreen Mode & Custom Status Bar

The app runs in fullscreen mode with a custom status bar:
- System status bar is hidden
- Custom status bar component shows time, battery, and network status
- Content area has proper padding to account for the custom status bar
- Configured in `src/main.js` using Capacitor's StatusBar plugin

## Troubleshooting

### Build Errors

- **"Module not found"**: Run `npm install` again
- **"Capacitor not found"**: Make sure Capacitor is installed: `npm install @capacitor/cli @capacitor/core @capacitor/android`

### Android Studio Issues

- **Gradle sync fails**: Update Android Studio and Gradle
- **SDK not found**: Install required SDK versions in Android Studio's SDK Manager

### OAuth Issues

- **"Invalid redirect URI"**: Make sure the redirect URI in Spotify dashboard matches exactly: `metrospotify://callback`
- **Token exchange fails**: Check that Client ID and Client Secret are correct

### Playback Issues

- **"No active device"**: Make sure Spotify is open on another device, or use the Web Player
- **"Premium required"**: Playback control requires a Spotify Premium subscription

## License

GNU General Public License v3.0 - See LICENSE file for details.

## Contributing

This is a port of the original SvelteKit web app to Android. The original codebase is preserved in the `legacy-ubq/` directory for reference.

## Credits

- Built with [Svelte](https://svelte.dev/)
- Native Android integration via [Capacitor](https://capacitorjs.com/)
- Spotify integration via [Spotify Web API](https://developer.spotify.com/documentation/web-api/)
- UI design inspired by Microsoft Metro/Windows Phone design language
